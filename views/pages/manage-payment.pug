extends ../layouts/layout.pug

block content
  #loading-overlay
      .spinner-border.text-primary(role="status")
          span.visually-hidden Loading...
  .container-fluid.py-4
    .d-flex.align-items-center.justify-content-between.mb-3.gap-3
      //- Date filters group
      .date-filter-group.flex
        .form-group
          label(for="startDate") Start Date
          input#startDate.form-control.form-control-sm(type="date")
        .form-group
          label(for="endDate") End Date
          input#endDate.form-control.form-control-sm(type="date")
      select#sortBySelect
        option(value='') Sắp xếp theo
        option(value='paidAt_asc') Ngày thanh toán ↑
        option(value='paidAt_desc') Ngày thanh toán ↓
        option(value='amount_asc') Số tiền ↑
        option(value='amount_desc') Số tiền ↓
    
    .input-group.input-group-sm.search-box(style="max-width: 460px;")
      span.input-group-text.bg-white.border-end-0
        i.fas.fa-search.text-muted
      input#inputSearch.form-control(type="search" placeholder="Search space name...")
    
    .d-flex.justify-content-between.mb-3.align-items-center.mt-3
      #statusFilterContainer.d-flex.flex-wrap.align-items-center.gap-2.mb-3
      .div
        label.form-label.mb-0.me-2(for="pageSizeSelect") Items per page:
        select#pageSizeSelect.form-select.form-select-sm(style="width: 100px;")
          option(value="10") 10
          option(value="20") 20
          option(value="30") 30
          option(value="50") 50

    //- Payments Table
    .card.shadow-sm
      .card-body.p-0
        table.table.table-striped.table-hover.align-middle.mb-0
          thead.table-light
            tr
              th(scope="col") ID
              th(scope="col") Space
              th(scope="col") Start - End Time
              th(scope="col") Payer
              th(scope="col") Amount
              th(scope="col") Method
              th(scope="col") Status
              th(scope="col") paidAt
              th(scope="col") Actions
          tbody
            each payment in payload.data || []
              tr
                td #{payment.id}
                td
                  strong #{payment.space.name}
                  br
                  small #{payment.space.type.replace('_',' ')}
                td #{new Date(booking.startTime).toLocaleString()} - #{new Date(booking.endTime).toLocaleString()}
                td #{payment.user.name}
                td #{payment.amount.toLocaleString()} VND
                td
                  - var statusClass = '';
                  if payment.status === 'PAID'
                    - statusClass = 'bg-success';
                  else if payment.status === 'PENDING'
                    - statusClass = 'bg-warning text-dark';
                  else
                    - statusClass = 'bg-danger';
                  span.badge(class=statusClass)= payment.status
                td
                  button.btn.btn-outline-info.btn-sm.view-payment-btn(type="button", data-payment-id=payment.id) View

    //- Pagination
    .mt-3
      nav#paginationContainer

  #currentUserConfig(data-current-user=payload.currentUser, style="display:none;")

  //- Scripts
  script(src="/vendor/toastify/toastify.js")
  script(src="/js/manage-payments.js")
